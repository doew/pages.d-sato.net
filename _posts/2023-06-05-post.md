---
title: Proxmox & LXD Container 便利
description: 仮想化バンザイ、Turnkey も便利。
layout: default_
---

## True NAS Scale辞めました
True NAS Scale, BSD から Debian系Linuxになりとても使いやすいな～UI綺麗だな～と思っていたのですが、辞めることにした。一番の理由は不安定だから。どう不安定かというと、GUIから設定すると一部の設定が反映されなかったり、エラーメッセージがきちんと返ってこなかったり。かといってCUIで設定するとドキュメント不足でどこからどこまでが独自仕様かいまいち分かりづらく、結局自分の環境では意図した動作を得られないことが多かった。

BSD時代の安定性を欠いた代わりにLinuxを得ている感もあり、まだ本番ユースできる感じにはあまり感じられないなあというのが本音。

## Proxmox VEへ
Openstackもすごく好きだけど、自宅サーバ・個人開発においては、安定性よりも拡張性よりも、楽に素早くデプロイできることを重視している。True NASの採用理由もそれ。だって仕事でくたくたなのに個人開発でも前途多難だったら泣き面に蜂になってしまうので。

今回はProxmoxVE（PVE）を採用してみることにした。自宅の空いているベアメタルサーバー3台に同時に展開した。うち2台はeMMCをメインストレージにしているので通常通りのインストールではダメだったのでそれをなんとかするエントリは別途かこうと思っているが、なんだかんだ比較的スッとインストール出来た。

## コミュニティサポートは案外開発元に牛耳られている？
これは除き始めて数日の僕があれこれ言える立場ではないんだけど、ファーストインプレッションとしてはそう感じた。逆に言えば、開発元が積極的にコミュニティサポートに参加しているとも言える。マイクロソフトのフォーラムも似たような雰囲気を感じられるので、いくつかの会社では積極的にコミュニティサポートに口だししていくような方針を採用していたりするのだろうか。この辺の戦略は是非聞いてみたい。

今回は「牛耳られている」とやや批判ぽく書いたのは、前述のeMMC の件でコミュニティサポートのスレッドは「対応していません」の一点張りで議論があまり広がっていなかったのを見て、コミュニティサポートなんだし免責でいろいろ知見を交換したらいいのに、と思ったから。

## クラスター作るのが便利だね
クラスターを作るのがとても簡単。ポチポチ。NICの冗長化もすぐ出来るし、クラスターの情報は特定の形式にまとめられて、共有が容易。いちいちホスト名とかポートとか証明書とか設定しなくてもピッとできた。

## LXD Containerとの親和性
今回はコンテナネイティブなサービスを移行させる予定で構成を変えたので、これはとてもポイント高い。ライブマイグレーションもスムーズだし、テンプレートのダウンロードもポチポチでとっても簡単。通常のハイパーバイザ型VMと違ってリソース効率がいいのも限られたスペックで運用するのにとっても向いてた。

## TurnKey
これは直接ProxmoxとかTrueNas辞めた話とは関わり薄いが、仮想アプライアンスの利用について最近思うことがある。仮想アプライアンスは積極的に使うといいんじゃないだろうか。

設定ファイルはデフォルトからレファレンスを読みながら、動確しながら書いていくのが基本だとは今でも思うが、問題はそこじゃない。セキュリティに関して発見があった。仮想アプライアンスが提供するサービスはどの程度セキュリティが担保されているかわからない（前述の設定ファイルが云々とも関わるが、設定ファイルは基本アプライアンスのデフォルトで使うので）。のでこれまでは、自分でコントロールしないといけないサービスは極力アプライアンス使わないでおく、と思っていた。

だが、新たな発見があった。設定ファイルの慣れの是正ができそうだと感じたのだった。例えば、今回はLXD ContainerのテンプレートとしてTurnkey MySQLを利用した。もちろんパスワードの入力以外は基本デフォルト値。トントン拍子で設定は終わりクライアントから接続するがつながらない。

この原因を調べるのに30分ほどかかったのだが、原因は至って単純で、TurnKey MySQLはデフォルトでSSLがONだが、クライアントのSSLの設定がOFFになっていたのだった。通常DBは外部からアクセスのできないプライベートネットワークに配置するのが慣例だと思う。となると他のサービスと同じように暗号化や認証に対応している例は案外少ないのではないだろうか。

設定ファイルを自前で書いていたら、初回はとりあえずSSLを切ってしまうだろうが、世の中HTTPSがデフォルトとなったように、今後はなんとなく書いていた設定もどこかで見直さないといけない時期が来る。だが、個人開発（やそれ以外も含め）ではなんだかんだ自前の設定ファイルでは慣れた設定で使いがちで、設定を見直したりトレンドに気付かずに遅れている事があるのでアプライアンスを使うことで、設定ファイルの慣れとガラパゴス化を是正できるのではないかと思った。なお、Google CloudではMySQLはデフォルトでSSLがONだったような気もするし、SSLの設定をONにするという方向性そのものは概ねこの方向に進んでいるのかもしれない。

あと、単純に超楽だしね・・・。

## まとめ
Proxmoxすごく使いやすかった＆仮想アプライアンス便利だし、個人開発と開発環境では積極的に使おうかな？
安定性に関してはしばらく稼働させてみてどうかは考えないといけないと思いつつ、ここ数日は元気に動いているように見える。今後はこの構成をデフォルトにしても悪くないかもなあ・・・。
